generator client {
  provider        = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  email         String          @unique
  password      String
  name          String?
  role          Role            @default(USER)
  lastLogin     DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  products      Product[]
  campaigns     AdCampaign[]
  budgets       Budget[]
  notifications Notification[]
  aiConfig      AIConfig?
  stockHistory  StockHistory[]
  automationRules AutomationRule[]
}

enum Role {
  ADMIN
  STOCK_STAFF
  USER
}

model Product {
  id              String          @id @default(cuid())
  name            String
  category        String
  quantity        Int             @default(0)
  minStockLevel   Int             @default(10)
  costPrice       Float
  sellPrice       Float
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  userId          String

  user            User            @relation(fields: [userId], references: [id])
  stockHistory    StockHistory[]
}

model StockHistory {
  id          String          @id @default(cuid())
  productId   String
  type        StockType
  quantity    Int
  reason      String?
  createdAt   DateTime        @default(now())
  userId      String

  product     Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  user        User            @relation(fields: [userId], references: [id])
}

enum StockType {
  ADD
  REMOVE
  ADJUST
}

model Budget {
  id          String          @id @default(cuid())
  amount      Float
  purpose     String
  spent       Float           @default(0)
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime        @default(now())
  userId      String

  user        User            @relation(fields: [userId], references: [id])
}

model AdCampaign {
  id            String          @id @default(cuid())
  platform      Platform
  campaignName  String
  budget        Float
  spent         Float           @default(0)
  reach         Int             @default(0)
  clicks        Int             @default(0)
  conversions   Int             @default(0)
  roi           Float           @default(0)
  status        CampaignStatus  @default(ACTIVE)
  startDate     DateTime
  endDate       DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  userId        String

  user          User            @relation(fields: [userId], references: [id])
}

enum Platform {
  FACEBOOK
  TIKTOK
  LAZADA
  SHOPEE
}

enum CampaignStatus {
  ACTIVE
  PAUSED
  COMPLETED
}

model Profit {
  id          String          @id @default(cuid())
  date        DateTime        @unique
  revenue     Float
  costs       Float
  netProfit   Float
  createdAt   DateTime        @default(now())
}

model Notification {
  id          String              @id @default(cuid())
  userId      String
  type        NotificationType
  message     String
  link        String?
  isRead      Boolean             @default(false)
  createdAt   DateTime            @default(now())

  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum NotificationType {
  LOW_STOCK
  BUDGET_REQUEST
  CAMPAIGN_COMPLETE
  AI_ALERT
}

model AIConfig {
  id              String      @id @default(cuid())
  geminiApiKey    String?
  openaiApiKey    String?
  n8nWebhook      String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  userId          String      @unique

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AutomationRule {
  id          String   @id @default(cuid())
  platform    String   // Facebook Ads, Google Ads, TikTok Ads, X Ads, Other
  tool        String   // Revealbot, AdEspresso, Madgicx, Custom (n8n webhook)
  ruleName    String
  condition   Json     // { metric: "CPA", operator: ">", value: 200 }
  action      Json     // { type: "pauseCampaign", value: "" }
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}